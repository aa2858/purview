#!/bin/bash
set -euo pipefail

ESC=$(printf '\033')
trap 'kill %1; kill %2' SIGINT

npx tsc -p tsconfig_src.json -w 2>&1 | sed -e "s/^/$ESC[33;1m[tsc]$ESC[0m /" &
npx parcel watch src/browser.ts 2>&1 | sed -e "s/^/$ESC[34;1m[parcel]$ESC[0m /" &

sleep 5 # Wait for first compile to finish.
MAIN=${1:-dist/examples/server.js}
npx nodemon "$MAIN" 2>&1
